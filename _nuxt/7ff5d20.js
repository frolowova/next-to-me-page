(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{399:function(e,t,r){"use strict";var n={props:{img:String}},l=r(45),o=r(50),c=r.n(o),d=r(240),f=r(158),v=r(404),component=Object(l.a)(n,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"image-view"},[t("v-img",{staticClass:"grey lighten-2",attrs:{src:this.img,"aspect-ratio":"1"},scopedSlots:this._u([{key:"placeholder",fn:function(){return[t("v-row",{staticClass:"fill-height ma-0",attrs:{align:"center",justify:"center"}},[t("v-progress-circular",{attrs:{indeterminate:"",color:"grey lighten-5"}})],1)]},proxy:!0}])})],1)}),[],!1,null,null,null);t.a=component.exports;c()(component,{VImg:d.a,VProgressCircular:f.a,VRow:v.a})},438:function(e,t,r){var content=r(546);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(25).default)("589af8cc",content,!0,{sourceMap:!1})},439:function(e,t,r){var content=r(548);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(25).default)("7c6d0918",content,!0,{sourceMap:!1})},545:function(e,t,r){"use strict";var n=r(438);r.n(n).a},546:function(e,t,r){(t=r(24)(!1)).push([e.i,'.show-all[data-v-06d728f3]{background:rgba(43,43,43,.4);position:relative;cursor:pointer}.show-all__info[data-v-06d728f3]{z-index:1;position:absolute;text-align:center;top:50%;left:50%;transform:translate(-50%,-50%)}.show-all__info p[data-v-06d728f3]{font-family:Roboto;font-style:normal;font-weight:400;font-size:14px;line-height:20px;letter-spacing:.16px;font-feature-settings:"pnum" on,"lnum" on;color:#fff}.show-all__info p+p[data-v-06d728f3]{margin-top:20px}',""]),e.exports=t},547:function(e,t,r){"use strict";var n=r(439);r.n(n).a},548:function(e,t,r){(t=r(24)(!1)).push([e.i,".create-tag-form[data-v-2700f838]{margin:auto}",""]),e.exports=t},565:function(e,t,r){"use strict";r.r(t);r(18),r(16),r(61),r(51),r(59),r(17),r(58);var n=r(380),l={components:{imageView:r(399).a},data:function(){return{isOpen:!1}},props:{arrayOfPic:{type:Array,default:[]}},methods:{setOpen:function(){this.isOpen=!this.isOpen}}},o=(r(545),r(45)),c=r(50),d=r.n(c),f=r(563),v=r(404),component=Object(o.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.isOpen||e.arrayOfPic.length<4?r("v-row",e._l(e.arrayOfPic,(function(img,i){return r("v-col",{key:i,staticClass:"d-flex child-flex",attrs:{cols:"4"},on:{dblclick:function(t){return e.$emit("remove-image",i)}}},[r("imageView",{attrs:{img:img}})],1)})),1):r("v-row",[e._l(e.arrayOfPic.slice(0,2),(function(img,i){return r("v-col",{key:i,staticClass:"d-flex child-flex",attrs:{cols:"4"},on:{dblclick:function(t){return e.$emit("remove-image",i)}}},[r("imageView",{attrs:{img:img}})],1)})),e._v(" "),r("v-col",[r("div",{staticClass:"show-all",on:{click:e.setOpen}},[r("div",{staticClass:"show-all__info"},[r("p",[e._v(e._s(e.arrayOfPic.length-3))]),e._v(" "),r("p",[e._v("Показать все")])]),e._v(" "),r("imageView",{attrs:{img:e.arrayOfPic[2]}})],1)])],2)],1)}),[],!1,null,"06d728f3",null),m=component.exports;d()(component,{VCol:f.a,VRow:v.a});var h=r(34),x={components:{tagImages:m},data:function(){return{valid:!0,loading:!1,tagText:"",selectedFiles:[],attachedFiles:[],rules:{required:function(e){return!!e||"Напишите-что нибудь"}},errorMessage:""}},computed:{totalFiles:function(){return this.selectedFiles.length+this.attachedFiles.length},arrayOfPic:function(){return this.attachedFiles.map((function(img){return img.url}))}},methods:{validate:function(){this.$refs.form.validate()},createTag:function(){var e=this;this.validate(),this.valid&&(this.loading=!0,this.$store.dispatch(h.SEND_MESSAGE,{text:this.tagText,photos:Object(n.a)(this.arrayOfPic)}).then((function(t){e.loading=!1,e.$router.push("/home")})).catch((function(t){e.loading=!1,e.errorMessage="Что-то пошло не так, попробуйте позже",setTimeout((function(){e.errorMessage=""}),3e3)})))},removeImage:function(e){this.attachedFiles=this.attachedFiles.filter((function(t,i){return i!==e}))},loadImage:function(){this.$refs.fileInput.$children[0].$el.click()},onChangeFile:function(){var e=this;if(this.selectedFiles.length){if(this.totalFiles>8)return alert("Вы не можете прикрепить больше 8 файлов!"),void(this.selectedFiles=[]);var t=Array.from(this.selectedFiles);this.selectedFiles=[],t.forEach((function(t){if("image/jpeg"===t.type){var r=new FileReader;r.addEventListener("load",(function(r){var n=r.target.result;e.compressImage(n,t)})),r.readAsDataURL(t)}}))}},compressImage:function(e,t){var r=this,canvas=document.createElement("canvas"),img=document.createElement("img");img.addEventListener("load",(function(){var e=img.width,n=img.height;e>n?e>1200&&(n=Math.round(n*=1200/e),e=1200):n>900&&(e=Math.round(e*=900/n),n=900),canvas.width=e,canvas.height=n,canvas.getContext("2d").drawImage(img,0,0,e,n);var l=canvas.toDataURL("image/jpeg",.8);r.attachedFiles.push({url:l,file:t})})),img.addEventListener("error",(function(){throw new Error("Compressed img error!")})),img.src=e}}},_=(r(547),r(400)),w=r(357),y=r(538),F=r(392),O=r(500),k=Object(o.a)(x,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"create-tag-form mx-6 mt-4"},[r("v-form",{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[r("span",{staticClass:"ml-2"},[e._v("Тег")]),e._v(" "),r("v-textarea",{staticClass:"rounded-xl mt-2",attrs:{"background-color":"cardBackground",solo:"","auto-grow":"",rules:[e.rules.required],placeholder:"Текст тега",autofocus:""},model:{value:e.tagText,callback:function(t){e.tagText=t},expression:"tagText"}}),e._v(" "),r("div",{staticClass:"images-block"},[r("tagImages",{attrs:{arrayOfPic:e.arrayOfPic},on:{"remove-image":e.removeImage}})],1),e._v(" "),e.errorMessage?r("v-alert",{attrs:{dense:"",text:"",type:"error"}},[e._v(e._s(e.errorMessage))]):e._e(),e._v(" "),r("div",{staticClass:"input-file-btn"},[r("v-file-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fileInput",attrs:{accept:"image/x-png,image/jpeg,image/gif",multiple:""},on:{change:e.onChangeFile},model:{value:e.selectedFiles,callback:function(t){e.selectedFiles=t},expression:"selectedFiles"}}),e._v(" "),r("v-btn",{staticClass:"mb-6 rounded-lg",attrs:{block:"",color:"primary",elevation:"0","x-large":"",outlined:"",disabled:e.loading},on:{click:function(t){return t.preventDefault(),e.loadImage(t)}}},[e._v("Добавить изображение")])],1),e._v(" "),r("v-btn",{staticClass:"rounded-lg",attrs:{block:"",color:"primary",elevation:"2","x-large":"",disabled:e.loading||!e.tagText.length,loading:e.loading},on:{click:function(t){return t.preventDefault(),e.createTag(t)}}},[e._v("Разместить")])],1)],1)}),[],!1,null,"2700f838",null),C=k.exports;d()(k,{VAlert:_.a,VBtn:w.a,VFileInput:y.a,VForm:F.a,VTextarea:O.a});var V={middleware:["auth","geoAlreadyGranted"],components:{createTagForm:C},headerData:{title:"Тегнуть"},btnValue:{value:"tag-create"}},E=Object(o.a)(V,(function(){var e=this.$createElement;return(this._self._c||e)("createTagForm")}),[],!1,null,null,null);t.default=E.exports}}]);